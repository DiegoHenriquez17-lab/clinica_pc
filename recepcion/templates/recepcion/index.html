{% extends 'base.html' %}

{% block title %}Recepción de Equipos - Clínica PC{% endblock %}

{% block content %}
<div class="mb-6">
    <h2 class="text-3xl font-bold text-gray-800">Recepción de Equipos</h2>
    <p class="text-gray-600 mt-1">Registrar nuevos dispositivos</p>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Reception Form -->
    <div class="lg:col-span-2">
        <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Nuevo Ingreso</h3>
            <form method="post" enctype="multipart/form-data" class="space-y-4">
                {% csrf_token %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Cliente *</label>
                        <input type="text" name="nombre_cliente" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">RUT Cliente</label>
                        <input type="text" name="rut_cliente" placeholder="12345678-9" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Teléfono *</label>
                        <input type="tel" name="telefono" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ciudad</label>
                        <input type="text" name="ciudad" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" name="correo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <!-- Campo de imagen del carnet -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-id-card mr-1"></i>Imagen del Carnet 
                        <span class="text-xs text-gray-500">(por seguridad)</span>
                    </label>
                    <input type="file" name="imagen_carnet" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <p class="text-xs text-gray-500 mt-1">Formatos permitidos: JPG, PNG, GIF (máx. 5MB)</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Dispositivo *</label>
                        <select name="tipo_equipo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                            <option value="">Seleccione...</option>
                            <option value="Laptop">Laptop</option>
                            <option value="PC Escritorio">PC Escritorio</option>
                            <option value="All-in-One">All-in-One</option>
                            <option value="Tablet">Tablet</option>
                            <option value="Servidor">Servidor</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Marca</label>
                        <input type="text" name="marca" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Modelo</label>
                    <input type="text" name="modelo" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Número de Serie</label>
                    <input type="text" name="serial" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Problema Reportado *</label>
                    <textarea name="problema" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Relato del Cliente * <span class="text-xs text-gray-500">(exacto, sin edición)</span></label>
                    <textarea name="relato_cliente" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Escriba aquí exactamente lo que relata el cliente..." required></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Caja Cliente <span class="text-xs text-gray-500">(accesorios incluidos)</span></label>
                        <textarea name="caja_cliente" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Descripción de lo que trae el cliente..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Caja Equipo <span class="text-xs text-gray-500">(estado del equipo)</span></label>
                        <textarea name="caja_equipo" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Estado físico del equipo recibido..."></textarea>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Observaciones del Recepcionista</label>
                    <textarea name="observaciones_recepcionista" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Observaciones adicionales del recepcionista..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Accesorios Incluidos</label>
                    <div class="grid grid-cols-2 gap-2">
                        <label class="flex items-center">
                            <input type="checkbox" name="accesorios" value="Cargador" class="mr-2"> Cargador
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="accesorios" value="Mouse" class="mr-2"> Mouse
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="accesorios" value="Teclado" class="mr-2"> Teclado
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="accesorios" value="Bolso" class="mr-2"> Bolso
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Observaciones Adicionales</label>
                    <textarea name="observaciones_adicionales" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition duration-200">
                    <i class="fas fa-plus-circle mr-2"></i>Registrar Equipo
                </button>
            </form>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="space-y-6">
        <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Ingresos Hoy</h3>
            <div class="text-center">
                <p class="text-5xl font-bold text-blue-600">{{ ingresos_hoy }}</p>
                <p class="text-gray-600 mt-2">equipos recibidos</p>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Últimos Ingresos</h3>
            <div class="space-y-3">
                {% for equipo in ultimos_ingresos %}
                    <div class="p-3 bg-gray-50 rounded-lg">
                        <p class="font-medium text-sm">{{ equipo.cliente.nombre }}</p>
                        <p class="text-xs text-gray-600">{{ equipo.tipo_equipo }}</p>
                        <p class="text-xs text-gray-500">{{ equipo.created_at|date:"H:i" }}</p>
                    </div>
                {% empty %}
                    <p class="text-gray-500 text-sm text-center py-4">No hay ingresos recientes</p>
                {% endfor %}
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-md p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">
                <i class="fas fa-users mr-2"></i>Clientes Recientes
            </h3>
            <div class="space-y-3">
                {% for cliente in clientes_recientes %}
                    <div class="p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                        <div class="flex justify-between items-center">
                            <div class="flex-1">
                                <p class="font-medium text-sm">{{ cliente.nombre }}</p>
                                {% if cliente.rut %}
                                <p class="text-xs text-gray-600">{{ cliente.rut }}</p>
                                {% endif %}
                                <p class="text-xs text-gray-500">{{ cliente.created_at|date:"d/m H:i" }}</p>
                            </div>
                            <div class="flex space-x-1">
                                <a href="{% url 'recepcion:ver_cliente' cliente.id %}" 
                                   class="text-blue-600 hover:text-blue-800 p-1 rounded" 
                                   title="Ver información">
                                    <i class="fas fa-eye text-xs"></i>
                                </a>
                                {% if cliente.imagen_carnet %}
                                <div class="text-green-600 p-1" title="Tiene carnet">
                                    <i class="fas fa-id-card text-xs"></i>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <p class="text-gray-500 text-sm text-center py-4">No hay clientes registrados</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}